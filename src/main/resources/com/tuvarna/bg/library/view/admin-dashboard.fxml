<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<StackPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.tuvarna.bg.library.controllers.AdminDashboardController"
           styleClass="dashboard-container">

    <!-- Header -->
    <VBox styleClass="header"
          style="-fx-background-color: white; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 5, 0, 0, 0);">
        <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-padding: 15 20;">
            <Label text="📚" style="-fx-font-size: 24px;" />
            <Label text="Library Management System - Admin Dashboard"
                   style="-fx-font-size: 18px; -fx-font-weight: bold;" />
            <Region HBox.hgrow="ALWAYS" />
            <Label fx:id="userLabel" text="Welcome, Admin" style="-fx-text-fill: #667eea;" />
            <Button text="Logout" styleClass="secondary-button" onAction="#handleLogout" />
        </HBox>
    </VBox>

    <!-- Main area (kept your offset under the header) -->
    <VBox style="-fx-translate-y: 60;">
        <TabPane styleClass="main-tab-pane">

            <!-- ========== BOOKS TAB ========== -->
            <Tab text="📖 Books Management" closable="false">
                <ScrollPane fitToWidth="true" hbarPolicy="NEVER" pannable="true"
                            style="-fx-background-color: transparent;">
                    <content>
                        <VBox spacing="20" style="-fx-padding: 20;">
                            <VBox styleClass="form-container" spacing="15">
                                <Label text="Add New Book" styleClass="form-title" />

                                <GridPane hgap="15" vgap="10">
                                    <Label text="Title:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="form-label" />
                                    <TextField fx:id="titleField" promptText="Enter book title"
                                               GridPane.columnIndex="1" GridPane.rowIndex="0" styleClass="text-field" />

                                    <Label text="ISBN:" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="form-label" />
                                    <TextField fx:id="isbnField" promptText="Enter ISBN"
                                               GridPane.columnIndex="1" GridPane.rowIndex="1" styleClass="text-field" />

                                    <Label text="Language:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="form-label" />
                                    <TextField fx:id="languageField" promptText="Enter language"
                                               GridPane.columnIndex="1" GridPane.rowIndex="2" styleClass="text-field" />

                                    <Label text="Publication Year:" GridPane.columnIndex="0" GridPane.rowIndex="3" styleClass="form-label" />
                                    <TextField fx:id="yearField" promptText="Enter publication year"
                                               GridPane.columnIndex="1" GridPane.rowIndex="3" styleClass="text-field" />

                                    <Label text="Publisher:" GridPane.columnIndex="0" GridPane.rowIndex="4" styleClass="form-label" />
                                    <ComboBox fx:id="publisherCombo" promptText="Select publisher"
                                              GridPane.columnIndex="1" GridPane.rowIndex="4" styleClass="text-field" />

                                    <Label text="Summary:" GridPane.columnIndex="0" GridPane.rowIndex="5" styleClass="form-label" />
                                    <TextArea fx:id="summaryArea" promptText="Enter book summary"
                                              GridPane.columnIndex="1" GridPane.rowIndex="5" styleClass="text-field"
                                              prefRowCount="3" wrapText="true" />

                                    <Label text="Cover Image:" GridPane.columnIndex="0" GridPane.rowIndex="6" styleClass="form-label" />
                                    <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="6" alignment="CENTER_LEFT">
                                        <Button text="Choose Image" styleClass="button" onAction="#chooseImage" />
                                        <Label fx:id="imageLabel" text="No image selected" style="-fx-text-fill: #6c757d;" />
                                    </HBox>

                                    <!-- Authors (dropdown + Add button that opens form) -->
                                    <Label text="Authors:" GridPane.columnIndex="0" GridPane.rowIndex="7" styleClass="form-label" />
                                    <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="7" alignment="CENTER_LEFT">
                                        <ComboBox fx:id="authorCombo" promptText="Select author" styleClass="text-field" />
                                        <Button text="Add Author" styleClass="secondary-button" onAction="#addAuthor" />
                                    </HBox>

                                    <Label text="Genres:" GridPane.columnIndex="0" GridPane.rowIndex="8" styleClass="form-label" />
                                    <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="8" alignment="CENTER_LEFT">
                                        <ComboBox fx:id="genreCombo" promptText="Select genre" styleClass="text-field" />
                                        <Button text="Add Genre" styleClass="secondary-button" onAction="#addGenre" />
                                    </HBox>

                                    <Label text="Copies:" GridPane.columnIndex="0" GridPane.rowIndex="9" styleClass="form-label" />
                                    <TextField fx:id="copiesField" promptText="Number of copies"
                                               GridPane.columnIndex="1" GridPane.rowIndex="9" styleClass="text-field" />
                                </GridPane>

                                <HBox spacing="15" alignment="CENTER">
                                    <Button text="Add Book" styleClass="button" onAction="#addBook" />
                                    <Button text="Clear Form" styleClass="secondary-button" onAction="#clearBookForm" />
                                </HBox>
                            </VBox>

                            <VBox styleClass="card" spacing="15">
                                <Label text="Books in Library" styleClass="card-title" />

                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <TextField fx:id="searchField" promptText="Search books..."
                                               styleClass="search-field" prefWidth="300" />
                                    <Button text="🔍" styleClass="search-button" onAction="#searchBooks" />
                                    <Region HBox.hgrow="ALWAYS" />
                                    <Button text="Refresh" styleClass="secondary-button" onAction="#refreshBooks" />
                                </HBox>

                                <TableView fx:id="booksTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn text="ID" fx:id="idColumn" />
                                        <TableColumn text="Title" fx:id="titleColumn" />
                                        <TableColumn text="ISBN" fx:id="isbnColumn" />
                                        <TableColumn text="Publisher" fx:id="publisherColumn" />
                                        <TableColumn text="Year" fx:id="yearColumn" />
                                        <TableColumn text="Copies" fx:id="copiesColumn" />
                                        <TableColumn text="Actions" fx:id="actionsColumn" />
                                    </columns>
                                </TableView>
                            </VBox>
                        </VBox>
                    </content>
                </ScrollPane>
            </Tab>

            <!-- ========== USERS TAB ========== -->
            <Tab text="👥 Users Management" closable="false">
                <ScrollPane fitToWidth="true" hbarPolicy="NEVER" pannable="true"
                            style="-fx-background-color: transparent;">
                    <content>
                        <VBox spacing="20" style="-fx-padding: 20%;">
                            <VBox styleClass="form-container" spacing="15">
                                <Label text="Add New User" styleClass="form-title" />

                                <GridPane hgap="15" vgap="10">
                                    <Label text="Username:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="form-label" />
                                    <TextField fx:id="userUsernameField" promptText="Enter username"
                                               GridPane.columnIndex="1" GridPane.rowIndex="0" styleClass="text-field" />

                                    <Label text="Password:" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="form-label" />
                                    <PasswordField fx:id="userPasswordField" promptText="Enter password"
                                                   GridPane.columnIndex="1" GridPane.rowIndex="1" styleClass="text-field" />

                                    <Label text="First Name:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="form-label" />
                                    <TextField fx:id="userFirstNameField" promptText="Enter first name"
                                               GridPane.columnIndex="1" GridPane.rowIndex="2" styleClass="text-field" />

                                    <Label text="Last Name:" GridPane.columnIndex="0" GridPane.rowIndex="3" styleClass="form-label" />
                                    <TextField fx:id="userLastNameField" promptText="Enter last name"
                                               GridPane.columnIndex="1" GridPane.rowIndex="3" styleClass="text-field" />

                                    <Label text="Email:" GridPane.columnIndex="0" GridPane.rowIndex="4" styleClass="form-label" />
                                    <TextField fx:id="userEmailField" promptText="Enter email"
                                               GridPane.columnIndex="1" GridPane.rowIndex="4" styleClass="text-field" />

                                    <Label text="Role:" GridPane.columnIndex="0" GridPane.rowIndex="5" styleClass="form-label" />
                                    <ComboBox fx:id="userRoleCombo" promptText="Select role"
                                              GridPane.columnIndex="1" GridPane.rowIndex="5" styleClass="text-field" />
                                </GridPane>

                                <HBox spacing="15" alignment="CENTER">
                                    <Button text="Add User" styleClass="button" onAction="#addUser" />
                                    <Button text="Clear Form" styleClass="secondary-button" onAction="#clearUserForm" />
                                </HBox>
                            </VBox>

                            <VBox styleClass="card" spacing="15">
                                <Label text="System Users" styleClass="card-title" />

                                <TableView fx:id="usersTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn text="ID" fx:id="userIdColumn" />
                                        <TableColumn text="Username" fx:id="userUsernameColumn" />
                                        <TableColumn text="Name" fx:id="userNameColumn" />
                                        <TableColumn text="Email" fx:id="userEmailColumn" />
                                        <TableColumn text="Role" fx:id="userRoleColumn" />
                                        <TableColumn text="Actions" fx:id="userActionsColumn" />
                                    </columns>
                                </TableView>
                            </VBox>
                        </VBox>
                    </content>
                </ScrollPane>
            </Tab>

            <!-- ========== REPORTS TAB ========== -->
            <Tab text="📊 Reports &amp; Analytics" closable="false">
                <ScrollPane fitToWidth="true" hbarPolicy="NEVER" pannable="true"
                            style="-fx-background-color: transparent;">
                    <content>
                        <VBox spacing="20" style="-fx-padding: 20;">
                            <HBox spacing="20">
                                <VBox styleClass="card" style="-fx-pref-width: 200;">
                                    <Label text="📚" style="-fx-font-size: 32px; -fx-alignment: center;" />
                                    <Label fx:id="totalBooksLabel" text="Total Books: 0" styleClass="card-title" />
                                </VBox>

                                <VBox styleClass="card" style="-fx-pref-width: 200;">
                                    <Label text="👥" style="-fx-font-size: 32px; -fx-alignment: center;" />
                                    <Label fx:id="totalUsersLabel" text="Total Users: 0" styleClass="card-title" />
                                </VBox>

                                <VBox styleClass="card" style="-fx-pref-width: 200;">
                                    <Label text="📖" style="-fx-font-size: 32px; -fx-alignment: center;" />
                                    <Label fx:id="activeLoansLabel" text="Active Loans: 0" styleClass="card-title" />
                                </VBox>

                                <VBox styleClass="card" style="-fx-pref-width: 200;">
                                    <Label text="⏰" style="-fx-font-size: 32px; -fx-alignment: center;" />
                                    <Label fx:id="overdueLabel" text="Overdue: 0" styleClass="card-title" />
                                </VBox>
                            </HBox>

                            <VBox styleClass="card" spacing="15">
                                <Label text="System Requests" styleClass="card-title" />
                                <VBox fx:id="requestCardsContainer" spacing="10" VBox.vgrow="ALWAYS" />
                            </VBox>
                        </VBox>
                    </content>
                </ScrollPane>
            </Tab>

        </TabPane>
    </VBox>

    <!-- Add Author Form Overlay -->
    <VBox fx:id="addAuthorForm" visible="false" styleClass="overlay-form"
          style="-fx-background-color: rgba(0,0,0,0.7); -fx-alignment: center;">
        <VBox styleClass="form-container" style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-max-width: 400;">
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 15 0;">
                <Label text="✏️" style="-fx-font-size: 20px;" />
                <Label text="Add New Author" styleClass="form-title" />
                <Region HBox.hgrow="ALWAYS" />
                <Button text="✕" styleClass="close-button" onAction="#cancelAuthor" />
            </HBox>

            <VBox spacing="10">
                <Label text="Full Name:" styleClass="form-label" />
                <TextField fx:id="authorNameField" promptText="Enter author's full name" styleClass="text-field" />

                <Label text="Birth Date (YYYY-MM-DD):" styleClass="form-label" />
                <TextField fx:id="authorBirthDateField" promptText="Enter birth date (optional)" styleClass="text-field" />

                <Label fx:id="authorMessageLabel" text="" style="-fx-text-fill: #27ae60; -fx-font-size: 14px;" />

                <HBox spacing="10" alignment="CENTER">
                    <Button text="Add Author" styleClass="button" onAction="#submitAuthor" />
                    <Button text="Cancel" styleClass="secondary-button" onAction="#cancelAuthor" />
                </HBox>
            </VBox>
        </VBox>
    </VBox>

    <!-- Add Genre Form Overlay -->
    <VBox fx:id="addGenreForm" visible="false" styleClass="overlay-form"
          style="-fx-background-color: rgba(0,0,0,0.7); -fx-alignment: center;">
        <VBox styleClass="form-container" style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-max-width: 400;">
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 15 0;">
                <Label text="📚" style="-fx-font-size: 20px;" />
                <Label text="Add New Genre" styleClass="form-title" />
                <Region HBox.hgrow="ALWAYS" />
                <Button text="✕" styleClass="close-button" onAction="#cancelGenre" />
            </HBox>

            <VBox spacing="10">
                <Label text="Genre Name:" styleClass="form-label" />
                <TextField fx:id="genreNameField" promptText="Enter genre name" styleClass="text-field" />

                <Label text="Description:" styleClass="form-label" />
                <TextArea fx:id="genreDescriptionArea" promptText="Enter genre description (optional)"
                          styleClass="text-field" prefRowCount="3" wrapText="true" />

                <Label fx:id="genreMessageLabel" text="" style="-fx-text-fill: #27ae60; -fx-font-size: 14px;" />

                <HBox spacing="10" alignment="CENTER">
                    <Button text="Add Genre" styleClass="button" onAction="#submitGenre" />
                    <Button text="Cancel" styleClass="secondary-button" onAction="#cancelGenre" />
                </HBox>
            </VBox>
        </VBox>
    </VBox>

</StackPane>
